"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),TypeMoneky=function(){function t(e){var n=this;_classCallCheck(this,t);var i={debug:!1,box:"",list:[],fontSize:16,lineHeight:1.2,letterSpacing:0,blockIndex:0,rowIndex:0,conPercent:.8,color:"#fff",background:"#000",beforeCreate:function(t,e,n){t()},afterEnd:function(){}};return this.opts=Object.assign(i,e),this.opts.debug&&(e.box.addEventListener("click",function(t){n.next()}),e.box.classList.add("tm-debug")),this}return _createClass(t,[{key:"init",value:function(t){var e=this.opts,n=e.box,i=this.getPrefix(),r=this.h("div",{"class":"tm-wrap"}),o=this.h("div",{"class":"tm-inner",style:{"font-size":e.fontSize+"px",lineHeight:e.lineHeight,background:e.background,color:e.color}});this.opts=Object.assign(e,{width:e.box.offsetWidth,height:e.box.offsetHeight,conWidth:e.box.offsetWidth*this.opts.conPercent,index:0,blockIndex:0,rowIndex:0}),n.innerHTML="",r.appendChild(o),n.appendChild(r),Object.assign(this,{$box:n,$wrap:r,$inner:o,prefix:i,killIe:/msie [6|7|8|9]/i.test(navigator.userAgent),transform:i+"transform"}),t&&(e.list=t),e.list&&this.initList()}},{key:"initList",value:function(){var t=this,e=this.opts;e.total=e.list.reduce(function(t,e,n,i){return 0===n&&t.l.push([]),"rotate"===e.type?(t.l[t.l.length-1].rotate=e.value,t.l.push([])):"text"===e.type&&(t.t++,t.l[t.l.length-1].push(e)),t},{r:0,t:0,l:[]});var n=[];e.total.l.forEach(function(e,i){var r="";r="rb"===e.rotate?"right bottom":"left bottom";var o=t.h("div",{"class":"tm-block tm-block-"+(i+1),style:_defineProperty({},t.prefix+"transform-origin",r)});o.rotate=e.rotate,n.length>0&&o.appendChild(n[n.length-1]),n.push(o)});var i=this.h("div",{"class":"tm-block tm-block-last",style:_defineProperty({},this.prefix+"transform-origin","left bottom")});i.appendChild(n[n.length-1]),n.push(i),this.$inner.appendChild(n[n.length-1]),this.$blocks=n,this.$blockLast=i}},{key:"start",value:function(){this.opts.list&&this.opts.list.length>0?this.next():alert("没有数据！")}},{key:"setOptList",value:function(t){this.opts.list=t}},{key:"createRow",value:function(t){var e=this,n=this.opts,i=n.list[t];if("rotate"===i.type)return n.index++,n.blockIndex++,n.rowIndex=0,void this.next();var r=this.$blocks[n.blockIndex],o=this.$blocks[this.$blocks.length-1],s=document.createDocumentFragment();i.value.split("").forEach(function(t,i){var r=e.createCol(t,i,n.rowIndex);s.appendChild(r)});var l=i.value.length*n.fontSize,a=n.fontSize*n.lineHeight,c=n.conWidth/l,h=l*c,u=a*c,f=this.h("div",{"class":"tm-row tm-row-"+(n.rowIndex+1),style:Object.assign({color:i.color},i.style)});if(n.blockIndex>0){var d=n.total.l[n.blockIndex-1],p=this.$blocks[n.blockIndex-1],b=n.total.l[n.blockIndex],v=void 0,g=0,y=void 0;if("lb"===p.rotate&&(v="-90"),"rb"===p.rotate){v="90";var x=Math.max.apply(null,d.map(function(t){return t.value.length})),k=d[d.length-1].value.length;y=k/x;var m=b[n.rowIndex].value.length,w=(Math.max.apply(null,b.map(function(t){return t.value.length})),b.slice(0,n.rowIndex).findIndex(function(t){return t.value.length>m}));if(0===n.rowIndex)g=100*(m-k)/m+"%";else if(w===-1)g=100*(m-k)/m+"%";else if(w>=0){var C=b[w].value.length;g=100*(C-k)/C+"%"}}var I=_defineProperty({left:g,top:-u*(d.length-1)/c+"px"},this.transform,"rotate("+v+"deg)");void 0!==y&&(I[this.prefix+"transform-origin"]=100*y+"% bottom"),this.setStyle(p,I)}r.scale=c,this.setStyle(r,{left:(n.width-h)/2/c+"px",top:(n.height-u*(n.rowIndex+1)-u*n.rowIndex)/2/c+"px"}),this.setStyle(o,_defineProperty({},this.transform,"translate3d(0,0,0) scale("+c+")")),f.appendChild(s),r.appendChild(f),n.index++,n.rowIndex++}},{key:"createCol",value:function(t,e,n){return this.h("span",{"class":"tm-col tm-col-"+(e+1),style:{width:this.opts.fontSize+"px"}},t)}},{key:"next",value:function(){var t=this.opts;if(t.index===t.list.length)this.isEnd=!0,this.opts.afterEnd.call(this);else{var e=t.index;this.opts.beforeCreate(this._next.bind(this,e),e,t.list[e],t)}}},{key:"clear",value:function(){this.opts.box.innerHTML=""}},{key:"_next",value:function(t){this.createRow(t)}},{key:"h",value:function(t,e,n){return this._createElement(t,e,n)}},{key:"_createElement",value:function(t,e,n){var i=this,r=document.createElement(t);return Object.keys(e).forEach(function(t){"style"===t?i.setStyle(r,e[t]):r.setAttribute(t,e[t])}),this.isType(n,"String")&&(r.innerHTML=n),r}},{key:"getStyleStr",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map(function(n){return t.str2label(n)+":"+e[n]+";"}).join("")}},{key:"setStyle",value:function(t,e){var n=this;Object.keys(e).forEach(function(i){t.style[n.label2str(i)]=e[i]})}},{key:"isType",value:function(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"}},{key:"str2label",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",n="";if(t[0].match(/[A-Z]+/))n=t.toLowerCase();else{var i=t.split(/[A-Z]+/);i.forEach(function(r,o){if(o>0){for(var s=0,l=o;l>0;l--)s+=i[l-1].length;n+=e+(i[o]=t.substr(s,1)+r).toLowerCase()}else n+=i[o].toLowerCase()})}return n}},{key:"label2str",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(e).filter(function(t){return t}).map(function(t,e){return 0!==e&&(t=t.substring(0,1).toUpperCase()+t.substring(1)),t}).join("")}},{key:"getPrefix",value:function(){return function(){var t=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1],n="WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1];return{dom:n,lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}.css}()}}]),t}();