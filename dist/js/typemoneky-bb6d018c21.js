"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),TypeMoneky=function(){function t(e){var n=this;_classCallCheck(this,t);var r={debug:!1,box:"",list:[],fontSize:16,lineHeight:1.1,letterSpacing:0,blockIndex:0,rowIndex:0,conPercent:.8,color:"#fff",background:"#000",beforeCreate:function(t,e,n){t()}};return this.opts=Object.assign(r,e),this.opts.debug&&e.box.addEventListener("click",function(t){n.next()}).classList.addClass("tm-debug"),this}return _createClass(t,[{key:"init",value:function(){var t=this,e=this.opts,n=e.box,r=this.getPrefix(),o=this.h("div",{"class":"tm-wrap"}),i=this.h("div",{"class":"tm-inner",style:{"font-size":e.fontSize+"px",lineHeight:e.lineHeight,background:e.background,color:e.color}}),l=[];this.opts=Object.assign(e,{width:e.box.offsetWidth,height:e.box.offsetHeight,conWidth:e.box.offsetWidth*this.opts.conPercent,total:e.list.reduce(function(t,e,n,r){return 0===n&&t.l.push([]),"rotate"===e.type?(t.l[t.l.length-1].rotate=e.value,t.l.push([])):"text"===e.type&&(t.t++,t.l[t.l.length-1].push(e)),t},{r:0,t:0,l:[]}),index:0,blockIndex:0,rowIndex:0}),e.total.l.forEach(function(e,n){var o="";o="rb"===e.rotate?"right bottom":"left bottom";var i=t.h("div",{"class":"tm-block tm-block-"+(n+1),style:_defineProperty({},r+"transform-origin",o)});i.rotate=e.rotate,l.length>0&&i.appendChild(l[l.length-1]),l.push(i)});var s=this.h("div",{"class":"tm-block tm-block-last",style:_defineProperty({},r+"transform-origin","left bottom")});s.appendChild(l[l.length-1]),l.push(s),i.appendChild(l[l.length-1]),o.appendChild(i),n.appendChild(o),Object.assign(this,{$box:n,$wrap:o,$inner:i,$blocks:l,$blockLast:s,prefix:r,killIe:/msie [6|7|8|9]/i.test(navigator.userAgent),transform:r+"transform"})}},{key:"start",value:function(){this.next()}},{key:"createRow",value:function(t){var e=this,n=this.opts,r=n.list[t];if("rotate"===r.type)return n.index++,n.blockIndex++,n.rowIndex=0,void this.next();var o=this.$blocks[n.blockIndex],i=this.$blocks[this.$blocks.length-1],l=document.createDocumentFragment();r.value.split("").forEach(function(t,r){var o=e.createCol(t,r,n.rowIndex);l.appendChild(o)});var s=r.value.length*n.fontSize,a=n.fontSize*n.lineHeight,c=n.conWidth/s,u=s*c,h=a*c,f=this.h("div",{"class":"tm-row tm-row-"+(n.rowIndex+1),style:{color:r.color}});if(n.blockIndex>0){var d=n.total.l[n.blockIndex-1],p=this.$blocks[n.blockIndex-1],b=n.total.l[n.blockIndex],v=void 0,g=0,y=void 0;if("lb"===p.rotate&&(v="-90"),"rb"===p.rotate){v="90";var x=Math.max.apply(null,d.map(function(t){return t.value.length})),m=d[d.length-1].value.length;y=m/x;var k=b[n.rowIndex].value.length,w=(Math.max.apply(null,b.map(function(t){return t.value.length})),b.slice(0,n.rowIndex).findIndex(function(t){return t.value.length>k}));if(0===n.rowIndex)g=100*(k-m)/k+"%";else if(w===-1)g=100*(k-m)/k+"%";else if(w>=0){var C=b[w].value.length;g=100*(C-m)/C+"%"}}var I=_defineProperty({left:g,top:-h*(d.length-1)/c+"px"},this.transform,"rotate("+v+"deg)");void 0!==y&&(I[this.prefix+"transform-origin"]=100*y+"% bottom"),this.setStyle(p,I)}o.scale=c,this.setStyle(o,{left:(n.width-u)/2/c+"px",top:(n.height-h*(n.rowIndex+1))/2/c-h*n.rowIndex/2/c+"px"}),this.setStyle(i,_defineProperty({},this.transform,"scale("+c+")")),f.appendChild(l),o.appendChild(f),n.index++,n.rowIndex++}},{key:"createCol",value:function(t,e,n){return this.h("span",{"class":"tm-col tm-col-"+(e+1),style:{width:this.opts.fontSize+"px"}},t)}},{key:"next",value:function(){var t=this.opts;if(t.index===t.list.length)this.isEnd=!0;else{var e=t.index;this.opts.beforeCreate(this._next.bind(this,e),e,t.list[e],t)}}},{key:"_next",value:function(t){this.createRow(t)}},{key:"h",value:function(t,e,n){return this._createElement(t,e,n)}},{key:"_createElement",value:function(t,e,n){var r=this,o=document.createElement(t);return Object.keys(e).forEach(function(t){"style"===t?r.setStyle(o,e[t]):o.setAttribute(t,e[t])}),this.isType(n,"String")&&(o.innerHTML=n),o}},{key:"getStyleStr",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map(function(n){return t.str2label(n)+":"+e[n]+";"}).join("")}},{key:"setStyle",value:function(t,e){var n=this;Object.keys(e).forEach(function(r){t.style[n.label2str(r)]=e[r]})}},{key:"isType",value:function(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"}},{key:"str2label",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",n="";if(t[0].match(/[A-Z]+/))n=t.toLowerCase();else{var r=t.split(/[A-Z]+/);r.forEach(function(o,i){if(i>0){for(var l=0,s=i;s>0;s--)l+=r[s-1].length;n+=e+(r[i]=t.substr(l,1)+o).toLowerCase()}else n+=r[i].toLowerCase()})}return n}},{key:"label2str",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(e).filter(function(t){return t}).map(function(t,e){return 0!==e&&(t=t.substring(0,1).toUpperCase()+t.substring(1)),t}).join("")}},{key:"getPrefix",value:function(){return function(){var t=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1],n="WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1];return{dom:n,lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}.css}()}}]),t}();